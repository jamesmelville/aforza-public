function runAction(e){let u=new Array,o=new Array,d=e.data.record,P=new Map,a=new Map;e.data.related.PricebookEntry.forEach(t=>{t.Pricebook2Id==d.Pricebook2Id&&P.set(t.Product2Id,t)}),e.data.related.OrderItem.forEach(t=>{if(t.aforza__Promotion__c)if(P.has(t.Product2Id)||o.push("Product "+t.Product2Id+" missing from Pricebook."),u.push("Item "+i+" orig qty ="+t.OriginalQuantity__c+"."),a.has(t.Product2Id)){let r=a.get(t.Product2Id),s=0;for(;s<r.length&&t.UnitPrice<r[s].UnitPrice;)s++;r.splice(s,0,t)}else a.set(t.Product2Id,new Array(t))});for(let t=1;t<11;t++){let r=d["MissingProduct"+t+"__c"],s=d["MissingQuantity"+t+"__c"];if(r&&!a.has(r))o.push("Missing Product "+t+" is not included in a Promotion in this order. Please check for the correct product.");else if(r&&!s)o.push("Please enter a quantity for Missing Product "+t+".");else if(r&&s){let f=a.get(r),n=s,l=0;for(;n>0&&l<f.length;){let c=f[l];c.Quantity>=n?(c.Quantity=c.Quantity-n,n=0):(n=n-c.Quantity,c.Quantity=0),l++}n>0?o.push("Missing Quantity exceeds ordered promotional quantity for Missing Product "+t+"."):u.push("Promotional Quantity(ies) adjusted for Missing Product "+t+".")}}return o.length>0?(e.data.error=o.join(`\r
`),e.data.updateDeviceData=!1,e.data.reprice=!1,e.data.blockExecution=!0):(e.data.message=u.join(`\r
`),e.data.updateDeviceData={Order:!0,OrderItem:!0},e.data.reprice=!1),e}
