function runAction(e){let d=new Array,s=new Array,a=e.data.record,l=new Map,o=new Map;e.data.related.PricebookEntry.forEach(t=>{t.Pricebook2Id==a.Pricebook2Id&&l.set(t.Product2Id,t)}),e.data.related.OrderItem.forEach(t=>{if(t.aforza__Promotion__c)if(l.has(t.Product2Id)||s.push("Product "+t.Product2Id+" missing from Pricebook."),t.Quantity=t.OriginalQuantity__c,o.has(t.Product2Id)){let i=o.get(t.Product2Id),r=0;for(;r<i.length&&t.UnitPrice<i[r].UnitPrice;)r++;i.splice(r,0,t)}else o.set(t.Product2Id,new Array(t))});for(let t=1;t<11;t++){let i=a["MissingProduct"+t+"__c"],r=a["MissingQuantity"+t+"__c"];if(i&&!o.has(i))s.push("Missing Product "+t+" is not included in a Promotion in this order. Please check for the correct product.");else if(i&&!r)s.push("Please enter a quantity for Missing Product "+t+".");else if(i&&r){let P=o.get(i),n=r,c=0;for(;n>0&&c<P.length;){let u=P[c];u.Quantity>=n?(u.Quantity=u.Quantity-n,n=0):(n=n-u.Quantity,u.Quantity=0),c++}n>0?s.push("Missing Quantity exceeds ordered promotional quantity for Missing Product "+t+"."):d.push("Promotional Quantity(ies) adjusted for Missing Product "+t+".")}}return s.length>0?(e.data.error=s.join(`\r
`),e.data.updateDeviceData=!1,e.data.reprice=!1,e.data.blockExecution=!0):(e.data.message=d.join(`\r
`),e.data.updateDeviceData={Order:!0,OrderItem:!0},e.data.reprice=!0),e}
